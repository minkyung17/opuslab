<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Series Rank Relevance</title>
                
        <!--#include virtual="../common/header.html" -->
        <!--        http://www.datatables.net/blog/2012-05-31 -->
        <!-- pace CSS (this is only used on DataTable pages) -->
<!--         <link rel="stylesheet" href="../stylesheets/site.css">    -->

    </head>

    <body>
        <!--#include virtual="../common/nav.html" -->
        <!-- Begin page content -->
        <div class="container-fluid" id="main">
            
            <div class="row-fluid">
                    <div class="page-header"> 
                          <h1>Series Rank Relevance</h1>
                    </div>
                  
   
                 
                 		
                    <div id="table-scroll-area">
                        <table id="seriesrank-table" class="display nowrap" cellspacing="0" width="100%">
                            <thead>
                                <tr> 
                                    <th class="nosort"></th>
                                    <th>Series Type Id</th>
                                    <th>Series Type</th>
                                    <th>Relevant Rank Types</th>
                                </tr>
                                <tr> 
                                    <td></td>
                                    <td class="column-filter"></td>
                                    <td class="column-filter"></td>
                                    <td class="column-filter"></td>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                    </div>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="infoModalLabel">Please Note</h4>
                    </div>                     
                </div>
            </div>
        </div>
                
        <!-- Generic Error -->    
        <div class="modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="error">
            <div class="modal-dialog ">
                <div class="modal-content">
                    <div class="modal-header modal-danger">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h2 class="white">Error</h2>
                    </div>
                    <div class="modal-body">                    
                    </div> <!-- /modal-body -->
                    <div class="modal-footer">                    
                        <button type="button" class="cancel btn btn-link left" data-dismiss="modal">Ok</button>
                    </div> 
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->  
        

        
        
        <!--#include virtual="relevance-modals.html" -->
                
        <!--#include virtual="../common/footer.html" -->

        <!--#include virtual="../common/js-includes.html" -->
         <!--#include virtual="../common/jquery-datatables.html" -->
        <script src="../javascript/jquery.selectlistactions.js"></script>
        <script src="relevance-logic.js"></script>
                             
        <!-- JavaScript Functionality -->
        <script> 
        var globalRankList ;
        var globalSeriesRankList ;
        var table;
        var seriesRankRelevanceDataRows;
        var pageName = 'seriesrank';
            function initializeTables() { 
            	if (adminData.dashboardRole = "OA" && adminData.adminRoles.indexOf("opus_admin")>=0) {
	                populateTableData();
            	} else {
            		 window.location.assign("/opusWeb/ui/error/access-error.shtml");
            	}
            }
            
			
            function populateTableData() {
                console.log("Before call: " + new Date($.now()));
                var SendInfo = {
                
                }; 
                $.ajax({
                    cache:false,
                    url: "/restServices/rest/admin/getSeriesRankRelevance/?access_token="+access_token, 
                    type: 'GET',
                    dataType: 'json',
                    contentType: 'application/json',
                    mimeType: 'application/json',
                    success: function(dataRows) {
                        if (dataRows == "") {                    
                            window.location.assign("/opusWeb/ui/error/access-error.shtml");       
                        }          
                        globalRankList = dataRows.ranksList;
                        globalSeriesRankList = dataRows.seriesRankMap;
                        seriesRankRelevanceDataRows = dataRows.seriesRankRelevanceRows;
                        initializeTable(seriesRankRelevanceDataRows); 
                    },
                    error:function(jqXHR, textStatus, errorThrown) {
                        if (jqXHR.responseText !== "") {  
                                $("#error .modal-body").empty();
                                $("#error .modal-body").append(jqXHR.responseText);
                                $('#error').modal('show');
                                console.log("Error: ", errorThrown);
                                console.log(jqXHR); 
                                console.log("Text Status: ", textStatus);
                        } else {                            
                                console.log("Error: ", errorThrown);
                                console.log(jqXHR); 
                                console.log("Text Status: ", textStatus);              
                                window.location.assign("/opusWeb/ui/error/access-error.shtml");     
                        }  
                    } 
                });
            }
                                    
            function initializeTable(inputData) {
                $('#seriesrank-table').DataTable( {
                    aaData: inputData,
                    dom: 'frtlip',
                    bPaginate: false, // include if no pagination
                    scrollY:        "530px", //set height of table
                    scrollX:        true, // allow horizontal scrolling
                    "orderClasses": false, // Always turn this off.  It highlights the sorted column.  Causes slowness.
                    scrollCollapse: true, // if have Fixed Columns
                    columns: [
					{data: "edit", 
					sDefaultContent:"",
						mRender:	function (data, type, full) {
											return '<a role="button" data-container="body" aria-label="help tip" trigger="hover" data-trigger="hover" tabindex="0" class="ttip" data-placement="top" data-toggle="popover" white-space="pre-wrap" data-html="true" data-content="View/Edit"><button type="button" class="btn btn-default edit-case-button" data-toggle="modal" data-target="#edit-modal" onclick="setEditValues(\''+ full.seriesTypeId + '\',\'' + full.seriesTypeId + '\',\'' + '#seriesType' + '\')"> <span aria-label="View/Edit" title="View/Edit" class="icon-pencil ttip"></span></button></a>';
									},
									name: "edit"
						},
                        {data: "seriesTypeId"}, 
                        {data: "seriesTypeDisplayText"},
                        {data: "rankTypeText"}  
                    ],
                    columnDefs: [{
                        "targets": 'nosort',
                        "orderable": false
                    }],
                    order: [[1, 'asc'],[0, 'asc']],
                    bSortCellsTop: true, //Sort on the top header cell (not the bottom)
                    sAjaxDataProp: "", //Use blank instead of aaData as array name
                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]], //Show # of entries
                    iDisplayLength: 25, //Show # of entries default
                    fnInitComplete: function(oSettings, json) { 
                        //For some reason, we have to re-initialize the table or it gives an 'undefined' error
                        var table = $('#seriesrank-table').DataTable();
                                                              
                    }
                });
                
                 //new $.fn.dataTable.FixedColumns( table); //needed to fix double header issue
            }
            
	        
        </script>
    </body>
</html>
