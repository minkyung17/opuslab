<!DOCTYPE html>
<html lang="en">
<head>
	<title>Academic Hierarchy Details</title>
	
<!--#include virtual="../common/header.html" -->
<!--        http://www.datatables.net/blog/2012-05-31 -->
<!-- pace CSS (this is only used on DataTable pages) -->
<!--         <link rel="stylesheet" href="../stylesheets/site.css">    -->
</head>

<body>
	<!--#include virtual="../common/nav.html" -->
	<!-- Begin page content -->
	<div class="container-fluid" id="main">

		<div class="row-fluid">
			<div class="page-header">
				<h1>Academic Hierarchy Details</h1>
			</div>
			<div id="table-scroll-area">
				<table id="academicHierarchy-table" class="display">
					<thead>
						<tr>

							<th>AH Path ID</th>
							<th>Edit</th>
							<th>Grouper Path Text</th>
							<th>Is Active</th>
							<th>Institution ID</th>
							<th>Institution Name</th>
							<th>Division ID</th>
							<th>Division Name</th>
							<th>School ID</th>
							<th>School Name</th>
							<th>Department ID</th>
							<th>Department Name</th>
							<th>Area ID</th>
							<th>Area Name</th>
							<th>Specialty ID</th>
							<th>Specialty Name</th>
							<th>ByC Unit ID</th>
						</tr>
						<tr>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
							<td class="column-filter"></td>
						</tr>
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<div class="modal" tabindex="-1" role="dialog"
		aria-labelledby="mySmallModalLabel" aria-hidden="true" id="update-row"
		data-backdrop="static">

		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header modal-info">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h1 class="modal-title">
						<span aria-hidden="true" class="icon-save modal-icon"></span>&nbsp;&nbsp;Academic
						Hierarchy ID: <span id="acadHID"> </span>
						<!-- 						<input type=text id="acadHID" value=acadHID></input> -->
					</h1>
				</div>
				
				<div class="modal-body">
					<form id="update-academic-form" role="form" class="form-horizontal">
						<div class="grouper-details">
												
							<div class="form-group">
								<label for="grouper-path" class="strong col-md-2"><Strong>Grouper Path:</Strong></label>
								<div class="col-md-10">
									<span id="grouper-path"> </span>
								</div>
							</div>
						</div>
						
						<div class="form-group">
							<label for="is-active" class="strong col-md-3"><Strong>Academic Hierarchy Active: </Strong></label>
							<div class="col-md-4">
								<span id="is-active"> </span>
							</div>
						</div>
						
						<h2>Opus Hierarchy</h2>
						<br>	
						<div class="form-group">
							<label for="inst-opus-id" class="strong col-md-2"><Strong>Institution</Strong></label>
							<div class="col-md-4">
								<span id="inst-opus-id"> </span> <span id="inst-opus-name"></span>
							</div>
						</div>
						
						<div class="form-group">
							<label for="div-opus-id" class="strong col-md-2"><Strong>Division: </Strong></label>
							<div class="col-md-6">
								<span id="div-opus-id"> </span> <span id="div-opus-name"></span>
							</div>
						</div>
						
						<div class="form-group">
							<label for="school-opus-id" class="strong col-md-2"><Strong>School: </Strong></label>
							<div class="col-md-6">
								<span id="school-opus-id"> </span> 
								<span id="school-opus-name"> </span>
							</div>
						</div>
								
						<div class="form-group">		
							<label for="dept-opus-id" class="strong col-md-2"><Strong>Department:</Strong></label>
								<div class="col-md-6">
									<span id="dept-opus-id"> </span> 
									<span id="dept-opus-name"></span>
								</div>
						</div>
						
						<div class="form-group">	
							<label for="area-opus-id" class="strong col-md-2"><Strong>Area: </Strong></label>
								<div class="col-md-6">
									<span id="area-opus-id"> </span> 
									<span id="area-opus-name"> </span>
								</div>
						</div>
						
						<div class="form-group">	
							<label for="spcl-opus-id" class="strong col-md-2"><Strong>Specialty: </Strong></label>
								<div class="col-md-6">
									<span id="spcl-opus-id"> </span> 
									<span id="spcl-opus-name"></span>
								</div>
						</div>
					</div>
				</div>
			</form>
		</div> <!-- /.modal-dialog -->
	</div> <!-- /.modal -->

	
	<!--#include virtual="relevance-modals.html" -->

	<!--#include virtual="../common/footer.html" -->

	<!--#include virtual="../common/js-includes.html" -->
	<!--#include virtual="../common/jquery-datatables.html" -->

	<!-- JavaScript Functionality -->
	<script>  
	
    //responsive table height upon load
    $ (document).ready(function() {
  	  console.log($(window).height());
  	  $('.dataTables_scrollBody').css('height', ($(window).height() - 400));
     });
  
  //responsive table height upon window resize
    $(window).resize(function() {
    	  console.log($(window).height());
    	  $('.dataTables_scrollBody').css('height', ($(window).height() - 400));
    	}); 
  
        var table;
        var seriesRankRelevanceDataRows;
        var pageName = 'ahpathGrouperText';
        
        function initializeTables() { 
        	if (adminData.dashboardRole = "OA" && adminData.adminRoles.indexOf("opus_admin")>=0) {
                populateTableData();
        	} else {
        		 window.location.assign("/opusWeb/ui/error/access-error.shtml");
        	}
        }
			
            function populateTableData() {
                console.log("Before call: " + new Date($.now()));
                var SendInfo = {
                
                }; 
                $.ajax({
                    cache:false,
                    url: "/restServices/rest/admin/academicHierarchyGrouperPath/?access_token="+access_token, 
                    type: 'GET',
                    dataType: 'json',
                    contentType: 'application/json',
                    mimeType: 'application/json',
                    success: function(dataRows) {
                        if (dataRows == "") {                    
                            window.location.assign("/restServices/ui/error/access-error.shtml");       
                        }            
                        seriesRankRelevanceDataRows = dataRows.academicHierarchies;
                        initializeTable(seriesRankRelevanceDataRows); 
                    },
                    error:function(jqXHR, textStatus, errorThrown) {
                        if (jqXHR.responseText !== "") {  
                                $("#error .modal-body").empty();
                                $("#error .modal-body").append(jqXHR.responseText);
                                $('#error').modal('show');
                                console.log("Error: ", errorThrown);
                                console.log(jqXHR); 
                                console.log("Text Status: ", textStatus);
                        } else {                            
                                console.log("Error: ", errorThrown);
                                console.log(jqXHR); 
                                console.log("Text Status: ", textStatus);              
                                window.location.assign("/opusWeb/ui/error/access-error.shtml");     
                        }  
                    } 
                });
            }
                                    
            function initializeTable(inputData) {
            	var otable = $('#academicHierarchy-table').DataTable( {
                    aaData: inputData,
                    dom: 'frtiS',
                    // bPaginate: false, // include if no pagination
                     "sScrollY": ($(window).height() - 400),
                     scrollX:        true, // allow horizontal scrolling
                     "orderClasses": false, // Always turn this off.  It highlights the sorted column.  Causes slowness.
                     //scrollCollapse: true, // if have Fixed Columns
                    columns: [
					{data: "academicHierarchyPathId"}, 
					{data: "edit", 
					sDefaultContent:"",
						mRender:	function (data, type, full) {
								return '<button type="button" id="update-row-button" class="btn btn-primary" data-toggle="modal" data-target="#update-row"><span aria-hidden="true" class="icon-plus"></span>View</button>';
							},
							name : "view",
							defaultContent : ""
						}, 
                {					data : "grouperPathText"
				}, {
					data : "active"
				}, {
					data : "institutionId"
				}, {
					data : "institutionName"
				}, {
					data : "divisionId"
				}, {
					data : "divisionName"
				}, {
					data : "schoolId"
				}, {
					data : "schoolName"
				}, {
					data : "departmentId"
				}, {
					data : "departmentName"
				}, {
					data : "areaId"
				}, {
					data : "areaName"
				}, {
					data : "specialtyId"
				}, {
					data : "specialtyName"
				}, {
					data : "byCUnitId"
				}
				
                    ],
                    columnDefs: [{
                        "targets": 'nosort',
                        "orderable": false
                    }],
                    order: [[1, 'asc'],[0, 'asc']],
                    bSortCellsTop: true, //Sort on the top header cell (not the bottom)
                    sAjaxDataProp: "", //Use blank instead of aaData as array name
                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]], //Show # of entries
                    iDisplayLength: 25, //Show # of entries default
                    fnInitComplete: function(oSettings, json) { 
                        //For some reason, we have to re-initialize the table or it gives an 'undefined' error
                        var table = $('#academicHierarchy-table').DataTable();
                                                              
                    }
                });
    			
    			$('#academicHierarchy-table tbody').on('click', 'tr', function() {
    				$(this).toggleClass('selected');				
    				 var iPos = otable.row( this ).index(); 
    				 var rowData = otable.row( this ).data();
    				// alert( 'Row index: '+ iPos + rowData.academicHierarchyPathId);
    				 $('#acadHID').html(rowData.academicHierarchyPathId); 
    				 $('#grouper-path').html(rowData.grouperPathText); 
      				 $('#inst-opus-id').html(rowData.institutionId); 
     				 $('#dept-opus-id').html(rowData.departmentId); 
      				 $('#div-opus-id').html(rowData.divisionId)+'<br/>'; 
      				 $('#school-opus-id').html(rowData.schoolId);  
      				 $('#area-opus-id').html(rowData.areaId); 
                     $('#spcl-opus-id').html(rowData.specialtyId); 
                     $('#is-active').html(rowData.active);
                     $('#dept-opus-name').html(rowData.departmentName);
                     $('#area-opus-name').html(rowData.areaName);
                     $('#spcl-opus-name').html(rowData.specialtyName);
                     $('#inst-opus-name').html(rowData.institutionName);
                     $('#div-opus-name').html(rowData.divisionName);
                     $('#school-opus-name').html(rowData.schoolName);
                     
    			}); 

    			//new $.fn.dataTable.FixedColumns(otable); //needed to fix double header issue
            }
            
	        
        </script>
</body>
</html>
